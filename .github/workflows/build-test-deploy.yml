on:
  release:
    types: published

jobs:
  build_test_deploy:
    runs-on: ubuntu-latest
    name: Test building HTML of IFE model and deploy container when successfull
    steps:
    - 
      name: Checkout
      uses: actions/checkout@v2
    - 
      name: Test building the image and exporting HTML
      uses: ./
    - 
      name: Deploy HTML to Github Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./public
    - 
      name: Push image to Dockerhub
      uses: docker/build-push-action@v1
      with:
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}
        repository: mtreber/capella-html-exporter
        tag_with_ref: true